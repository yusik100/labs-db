generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  user_id           Int            @id @default(autoincrement())
  name              String         @db.VarChar(50)
  email             String         @unique @db.VarChar(255)
  password_hash     String         @db.VarChar(255)
  registration_date DateTime       @default(dbgenerated("CURRENT_DATE")) @db.Date
  is_active         Boolean        @default(true)
  reviews           Review[]
  playlist          playlist[]
  subscription      subscription[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model album {
  album_id     Int           @id @default(autoincrement())
  title        String        @db.VarChar(100)
  release_year Int
  reviews      Review[]
  albumartist  albumartist[]
  track        track[]
}

model albumartist {
  album_id  Int
  artist_id Int
  album     album  @relation(fields: [album_id], references: [album_id], onDelete: Cascade, onUpdate: NoAction)
  artist    artist @relation(fields: [artist_id], references: [artist_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([album_id, artist_id])
}

model artist {
  artist_id   Int           @id @default(autoincrement())
  stage_name  String        @unique @db.VarChar(50)
  country     String?       @db.VarChar(50)
  albumartist albumartist[]
  trackartist trackartist[]
}

model playlist {
  playlist_id   Int             @id @default(autoincrement())
  title         String          @db.VarChar(100)
  created_at    DateTime        @default(dbgenerated("CURRENT_DATE")) @db.Date
  user_id       Int
  User          User            @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  playlisttrack playlisttrack[]
}

model playlisttrack {
  playlist_id Int
  track_id    Int
  playlist    playlist @relation(fields: [playlist_id], references: [playlist_id], onDelete: Cascade, onUpdate: NoAction)
  track       track    @relation(fields: [track_id], references: [track_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([playlist_id, track_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model subscription {
  subscription_id  Int              @id @default(autoincrement())
  type_id          Int
  start_date       DateTime         @db.Date
  end_date         DateTime?        @db.Date
  user_id          Int
  subscriptiontype subscriptiontype @relation(fields: [type_id], references: [type_id], onUpdate: NoAction)
  User             User             @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model subscriptiontype {
  type_id      Int            @id @default(autoincrement())
  name         String         @unique @db.VarChar(50)
  price        Decimal        @db.Decimal(6, 2)
  subscription subscription[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model track {
  track_id         Int             @id @default(autoincrement())
  title            String          @db.VarChar(150)
  duration_seconds Int
  release_date     DateTime        @db.Date
  album_id         Int?
  playlisttrack    playlisttrack[]
  album            album?          @relation(fields: [album_id], references: [album_id], onDelete: Cascade, onUpdate: NoAction)
  trackartist      trackartist[]
}

model trackartist {
  track_id  Int
  artist_id Int
  artist    artist @relation(fields: [artist_id], references: [artist_id], onDelete: Cascade, onUpdate: NoAction)
  track     track  @relation(fields: [track_id], references: [track_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([track_id, artist_id])
}

model Review {
  review_id  Int      @id @default(autoincrement())
  comment    String?
  created_at DateTime @default(now())
  user_id    Int
  album_id   Int
  album      album    @relation(fields: [album_id], references: [album_id], onDelete: Cascade)
  User       User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}
